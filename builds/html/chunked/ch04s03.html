<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>4.3. Data Analysis</title><link rel="stylesheet" type="text/css" href="atug.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="ATCA Users Guide"><link rel="up" href="ch04.html" title="Chapter 4. After your Observations"><link rel="prev" href="ch04s02.html" title="4.2. Report Your Experiences"><link rel="next" href="ch04s04.html" title="4.4. Publishing Results"><script src="/jslib/mathjax/2.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><?php include( $_SERVER['DOCUMENT_ROOT'] . "/includes/standard_head.inc" ) ?></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><?php include( $_SERVER['DOCUMENT_ROOT'] . "/includes/title_bar_atnf.inc" ) ?><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.3. Data Analysis</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s02.html">Prev</a> </td><th width="60%" align="center">Chapter 4. After your Observations</th><td width="20%" align="right"> <a accesskey="n" href="ch04s04.html">Next</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="Data-Analysis"></a>4.3. Data Analysis</h2></div></div></div>
    
    <p>
      This section will describe how to get started on reducing <acronym class="acronym">CABB</acronym> data
      using the <span class="application">Miriad</span> software suite. More information can be found
      in the 
      <a class="ulink" href="http://www.atnf.csiro.au/computing/software/miriad" target="_top"><span class="application">Miriad</span> manual</a>.
      The manual's cookbook should be read by all users before starting
      their first data reduction. This section will summarise how reduction
      differs for <acronym class="acronym">CABB</acronym> data, and give a reasonable guide on how to do a
      simple continuum reduction. The <span class="application">Miriad</span> manual has been updated to
      incorporate information on <acronym class="acronym">CABB</acronym> data reduction, but work continues on
      improving it.
    </p>

    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Updating-Miriad"></a>4.3.1. Updating <span class="application">Miriad</span></h3></div></div></div>
      

      <p>
	<span class="application">Miriad</span> development is ongoing, in order to fix bugs and introduce
	new features useful for <acronym class="acronym">ATCA</acronym> data reduction. It is therefore important that
	before beginning your data reduction that you
	obtain the very latest <span class="application">Miriad</span> distribution, as new features may have
	been implemented that will make your reduction easier or more successful, or
	may solve an issue that you were experiencing with an older version of
	<span class="application">Miriad</span>.
      </p>

      <p>
	To get the latest <span class="application">Miriad</span> distribution, please follow the instructions
	<a class="ulink" href="http://www.atnf.csiro.au/computing/software/miriad/INSTALL.html" target="_top">in the install guide</a>.
      </p>

      <p>
	It is also important to report any problems you may have with your reduction
	to the <span class="application">Miriad</span> maintenance team so that any issues can be resolved. If
	you experience any problems, please use the <span class="command"><strong>mirbug</strong></span> routine, or send an
	email describing your problem to <code class="email">&lt;<a class="email" href="mailto:miriad@atnf.csiro.au">miriad@atnf.csiro.au</a>&gt;</code>. If you don't
	think your problem is related to a bug, but you need advice on how best to
	proceed with your reduction, please ask for help using the 
	<a class="ulink" href="http://atcaforum.atnf.csiro.au" target="_top"><acronym class="acronym">ATCA</acronym> Forum</a>.
	<acronym class="acronym">ATCA</acronym> and <acronym class="acronym">ATNF</acronym> staff routinely check
	the forum and answer questions from the community, making the forum a good
	place to start to look for answers as well.
      </p>
    </div>

    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Loading-Data"></a>4.3.2. Loading Data</h3></div></div></div>
      
      <p>
	Data files from <acronym class="acronym">CABB</acronym> are much larger than those generated by the old
	correlator, so it is recommended that you process them on a machine with
	plenty of physical memory (RAM). If you rely on virtual memory to work with
	<acronym class="acronym">CABB</acronym> data files, then you will experience very poor performance.
      </p>

      <p>
	To load <acronym class="acronym">CABB</acronym> data, you will use the <span class="command"><strong>atlod</strong></span> task. The inputs to this task
	should, in general, be the same as for pre-<acronym class="acronym">CABB</acronym> data. However there are two
	options that should be used for all <acronym class="acronym">CABB</acronym> data to make subsequent reduction
	more pleasant. These two options are <code class="option">birdie</code> and <code class="option">rfiflag</code>.
      </p>

      <p>
	The <code class="option">birdie</code> option was always recommended for pre-<acronym class="acronym">CABB</acronym> data, but
	for a different reason. For <acronym class="acronym">CABB</acronym> data, a number of channels are affected
	by self-generated interference from the 640 MHz <acronym class="acronym">CABB</acronym> clock, and the
	<code class="option">birdie</code> option flags these channels during load. It also flags out
	4.9% of channels on each band edge (which works out to be 100 channels for <acronym class="acronym">CABB</acronym>'s
	2049 channel spectra) and, for 20/13cm data taken before 2010-Aug-17, the unusable parts of the spectrum in
	the old, separate 20cm and 13cm bands. These unusable parts are due to the fact that these
	receivers did not respond to all frequencies across the 2 GHz bandwidth of
	<acronym class="acronym">CABB</acronym>. This option still works for pre-<acronym class="acronym">CABB</acronym> data as expected.
      </p>

      <p>
	If you wish to change the number of edge channels that are flagged by the <code class="option">birdie</code>
	option, use the <em class="parameter"><code>edge</code></em> parameter in <span class="command"><strong>atlod</strong></span>. By default it is
	set to 9.8 (per cent), which works out to 200 channels for a 2049 channel spectrum. These flagged
	channels are split evenly to the top and bottom of the spectrum, so if you wanted to flag only 32
	channels on each band edge for example, you should specify
	<em class="parameter"><code>edge</code></em>=<code class="option">3.1</code>.
      </p>

      <p>
	The <code class="option">rfiflag</code> option can be used now to automatically flag out
	frequency bands that are known to be heavily affected by RFI.
	This option is most useful in the 16cm band, where the <acronym class="acronym">ATCA</acronym>
	receivers are routinely affected by strong RFI. It is completely safe to use at
	any band however, and should be included in the default list of options when you
	use <span class="command"><strong>atlod</strong></span>. The file it uses to determine the flagging it performs can be
	customised to include extra flagging (or less flagging) if so desired. By default,
	this file (called <code class="filename">rfiflag.txt</code>) can be found in the directory
	<code class="filename">cat</code> in the <span class="application">Miriad</span> tree. 
	To customise it, copy it to your reduction
	directory, insert or remove more frequency ranges to flag, and then load your
	data with <span class="command"><strong>atlod</strong></span>.
      </p>

      <p>
	Note that the
	<code class="option">rfiflag</code> option will have no effect if the <code class="option">birdie</code> option
	is not also specified.
      </p>

      <p>
	Another useful <span class="command"><strong>atlod</strong></span> option is <code class="option">xycorr</code>. This corrects the
	measured XY phase of the <acronym class="acronym">ATCA</acronym>, and can be safely included at all bands for
	<acronym class="acronym">CABB</acronym> data.
      </p>

      <p>
	By default, <acronym class="acronym">CABB</acronym> records the autocorrelations from each of the antenna that
	are being used, which may not be useful if all you are interested in is the
	cross-correlations required to make an image. Having the autocorrelations
	present during the reduction does no harm to any of the <span class="application">Miriad</span> routines,
	but may become confusing and/or annoying when trying to examine the data. You
	can make <span class="command"><strong>atlod</strong></span> discard these data by using the <code class="option">noauto</code> option.
      </p>

      <p>
	The other <span class="command"><strong>atlod</strong></span> options are usually frequency dependent. Examples of
	<span class="command"><strong>atlod</strong></span> use are given below for all <acronym class="acronym">ATCA</acronym> bands.
      </p>
      <div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>16cm band</strong></span></span></dt><dd>
	    <pre class="screen">
Task:   atlod
in       = *.C007
out      = c007.uv
ifsel    = 1
restfreq =
options  = birdie,xycorr,rfiflag,noauto
nfiles   =
nscans   =
nopcorr  =
edge     =
</pre>
	    <p>
	      For this band, if you used identical centre frequencies in both IFs,
	      you need only extract one of them as both IFs will contain
	      identical data, and keeping both may lead to confusion later on.
	    </p>
	  </dd><dt><span class="term"><span class="bold"><strong>4cm band</strong></span></span></dt><dd>
	    <pre class="screen">
Task:   atlod
in       = *.C007
out      = c007.uv
ifsel    = 
restfreq =
options  = birdie,xycorr,rfiflag,noauto
nfiles   =
nscans   =
nopcorr  =
edge     =
</pre>
	    <p>
	      If you chose to use the same centre frequency for both IFs then you should
	      extract only 1 IF using the <em class="parameter"><code>ifsel</code></em> parameter as described above.
	    </p>
	  </dd><dt><span class="term"><span class="bold"><strong>15mm &amp; 7mm bands</strong></span></span></dt><dd>
	    <pre class="screen">
Task:   atlod
in       = *.C007
out      = c007.uv
ifsel    = 
restfreq =
options  = birdie,xycorr,rfiflag,opcorr,noauto
nfiles   =
nscans   =
nopcorr  =
edge     =
</pre>
	    <p>
	      At these mm bands, you should include the <code class="option">opcorr</code> option to
	      correct for atmospheric opacity. If you observed at frequencies where the
	      atmospheric opacity varies quickly as a function of frequency (for example,
	      near the water line at 22 GHz), then you should set the
	      <em class="parameter"><code>nopcorr</code></em> parameter to allow multiple opacity correction
	      factors across the band, up to a maximum of 32 bins.
	    </p>
	  </dd><dt><span class="term"><span class="bold"><strong>3mm band</strong></span></span></dt><dd>
	    <pre class="screen">
Task:   atlod
in       = *.C007
out      = c007.uv
ifsel    = 
restfreq =
options  = birdie,xycorr,rfiflag,noauto
nfiles   =
nscans   =
nopcorr  =
edge     =
</pre>
	  </dd></dl></div>
    </div>
    
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Correcting-mm-data"></a>4.3.3. Correcting mm data</h3></div></div></div>
      
      <p>
	For higher frequency data, the <span class="command"><strong>atfix</strong></span> routine may be required to apply
	corrections to the antenna positions and system temperature measurements.
      </p>

      <p>
	During a baseline reconfiguration at the <acronym class="acronym">ATCA</acronym>, staff perform a baseline
	calibration (to determine precisely where each antenna is with respect to each other) at 5 GHz and
	17 GHz. During normal observing, the solution determined at 5 GHz is applied
	on-line, and is usually very good. However, for mm data, you may wish to use
	more precise antenna positions obtained from the 17 GHz baseline calibration.
	This may aid in phase referencing experiments.
      </p>

      <p>
	The <span class="command"><strong>atfix</strong></span> routine can &#8220;fix&#8221; the positions of the <acronym class="acronym">ATCA</acronym> antennas based
	on the solution file that is made available by the <acronym class="acronym">ATCA</acronym> staff on the
	<a class="ulink" href="http://www.narrabri.atnf.csiro.au/observing/antpos/" target="_top">
	  baseline solutions page</a>. 
	  The high-frequency baseline solutions are not routinely computed for each reconfiguration, so
	  if you'd like to have one, please contact <acronym class="acronym">ATCA</acronym> staff with your request.
      </p>

      <p>
	The task <span class="command"><strong>atfix</strong></span> is also highly recommended for the reduction of 3mm data.
	During an observation at 3mm, the system temperature is determined using the
	paddle during a so-called &#8220;paddle scan&#8221;. These scans are usually tens of
	minutes apart, during which time the system temperature recorded by the
	correlator does not change. To make <span class="application">Miriad</span> interpolate the system
	temperature between the paddle scans, use <span class="command"><strong>atfix</strong></span> with default parameters,
	or with <em class="parameter"><code>tsyscal</code></em>=<code class="option">interpolate</code> explictly set.
      </p>
      <pre class="screen">
Task:   atfix
vis      = 3mm_data.uv
select   =
out      = 3mm_data_fixed.uv
dantpos  = 
tsyscal  =
options  =
array    =
</pre>
    </div>

    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Splitting-the-dataset"></a>4.3.4. Splitting the dataset</h3></div></div></div>
      
      <p>
	After loading the data into a <span class="application">Miriad</span> dataset, it is usually most
	convenient to split this into many datasets, each containing an individual
	source at a single central frequency. This is done using the uvsplit
	task.
      </p>

      <p>
	At its simplest, it can be run with only the <em class="parameter"><code>vis</code></em> parameter set to
	the parent dataset, but it is also very easy to use the <em class="parameter"><code>select</code></em> parameter
	here to discard data that was affected by antenna shadowing:
      </p>
      <pre class="screen">
Task:   uvsplit
vis      = c007.uv
select   = -shadow(22.5)
options  =
maxwidth =
</pre>
      <p>
	The <em class="parameter"><code>select</code></em> keyword can also be used to split out only certain sources,
	or to effectively flag out certain antenna. Read about the <em class="parameter"><code>select</code></em>
	keyword 
	<a class="ulink" href="http://www.atnf.csiro.au/computing/software/miriad/doc/select.html" target="_top">
	  in the <span class="application">Miriad</span> manual</a>.
      </p>

      <p>
	There are two options that are useful here. Specify the
	<code class="option">mosaic</code> option if you are splitting a dataset that contains a mosaic
	observation, and specify the <code class="option">clobber</code> option if you want to overwrite
	any previously split-out datasets in the current directory.
      </p>

      <p>
	The <em class="parameter"><code>maxwidth</code></em> parameter is new to the <acronym class="acronym">CABB</acronym> era, and allows you to
	break up the 2 GHz <acronym class="acronym">CABB</acronym> bandwidth into smaller chunks. This will be most useful
	at lower frequencies where 2 GHz represents a large fractional bandwidth. At
	such frequencies, calibration and imaging is far more challenging than at higher
	frequencies. The bandwidth specified here should be specified in GHz. For example,
	to mimic the maximum bandwidth available from the old correlator, you could
	specify <em class="parameter"><code>maxwidth</code></em>=<code class="option">0.128</code> here. Recent experience shows
	however that excellent calibration can be obtained using the entire 2 GHz band simultaneously, even
	in the 16cm band. Splitting up the band at this point then is only recommended for those who have
	an actual need to do so.
      </p>
    </div>

    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Flagging"></a>4.3.5. Flagging</h3></div></div></div>
      
      <p>
	In most cases, if the <code class="option">birdie</code> and <code class="option">rfiflag</code> options are given
	to <span class="command"><strong>atlod</strong></span>, the data will be mostly free from RFI at this point. However,
	you should always examine your data with the <span class="command"><strong>uvplt</strong></span> and <span class="command"><strong>uvspec</strong></span> tasks
	to make sure.
	<a class="indexterm" name="idm46395604927888"></a>
      </p>

      <p>
	Using <span class="command"><strong>uvplt</strong></span>, examining amplitude and phase versus time is a good way to
	find time ranges that have been affected by RFI. Ensure that you specify
	<em class="parameter"><code>options</code></em>=<code class="option">nofqav</code> to prevent <span class="command"><strong>uvplt</strong></span> from averaging your data over
	frequency before plotting. Any RFI present in your observations may
	be restricted to only a few channels, and these channels can be identified
	by using <span class="command"><strong>uvspec</strong></span>.
      </p>

      <p>
	To flag this data, you can use the following tasks.
      </p>
      <div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>uvflag</strong></span></span></dt><dd>
	    <p>
	      <a class="indexterm" name="idm46395604920576"></a>
	      Use the <em class="parameter"><code>select</code></em> and <em class="parameter"><code>line</code></em> keywords to select the bad data
	      and set <em class="parameter"><code>flagval</code></em>=<code class="option">flag</code> to flag the data as bad.
	      <span class="command"><strong>uvflag</strong></span> can be used to flag any set of bad data, but can be tediously repetitive.
	    </p>
	  </dd><dt><span class="term"><span class="command"><strong>blflag</strong></span></span></dt><dd>
	    <p>
	      <a class="indexterm" name="idm46395604914896"></a>
	      This task can replicate many of the plots that <span class="command"><strong>uvplt</strong></span> generates, which
	      may allow you to directly select the outliers representing bad data.
	    </p>
	  </dd><dt><span class="term"><span class="command"><strong>pgflag</strong></span></span></dt><dd>
	    <p>
	      <a class="indexterm" name="idm46395604910816"></a>
	      This task replaces the old <span class="command"><strong>tvflag</strong></span> task that no longer works on
	      displays with more than an 8-bit colour depth. <span class="command"><strong>pgflag</strong></span> displays data as
	      a channel-time waterfall plot and allows direct selection of ranges of bad
	      data and flexible flagging options. It also includes an automatic flagging routine
	      that uses the <em class="firstterm">SumThreshold</em> method that is available in the
	      <a class="ulink" href="http://sourceforge.net/p/aoflagger/wiki/Home/" target="_top"><span class="application">AOFlagger</span></a>, and is
	      highly recommended for use during continuum reductions.
	    </p>
	  </dd></dl></div>

      <p>
	One trap that you may find is that if you are observing at 3mm and some other band in the
	same run, and you elected to keep CA06 tracking for the 3mm observations, the data from CA06
	will not automatically be flagged. This is because CA06 has almost all the systems required for
	3mm observing (save for the electronics), and so the antenna really is &#8220;on source&#8221;
	according to the telescope. You should use <span class="command"><strong>uvflag</strong></span> to flag out CA06 data in
	this case.
      </p>

      <p>
	<a class="indexterm" name="idm46395604904800"></a>
	Automatic flagging with <span class="command"><strong>pgflag</strong></span> can be very effective if it is done in
	the right way. It is most useful for continuum observations in any band, and for spectral line
	observations when the line is not detectable in a single integration. If your spectral line
	is bright enough to be detected in a single integration, then the flagging routine will likely
	identify it as RFI.
      </p>

      <p>
	The <span class="command"><strong>pgflag</strong></span> task accepts a number of parameters that control the automatic
	flagging process. Craig Anderson identified, through trial and error, a recipe that works
	quite well for 16cm data; this recipe is described in
	<a class="ulink" href="https://atcaforum.atnf.csiro.au/viewtopic.php?f=10&amp;t=167" target="_top">
	  an ATCA Forum post Craig started</a>. We describe this recipe here as well, and we
	  recommend this recipe for data in any band.
      </p>

      <p>
	This flagging recipe uses the concept that the polarisation properties of interference are
	quite different to that of the signals we're interested in. For the most part, the radio
	sky is free of discrete sources of circular polarisation, and thus most measurements of Stokes V from our
	interferometer should be thermal noise only. This assumption holds over all frequencies as well.
	So if we see a large deviation from thermal noise in Stokes V, and this deviation is confined to
	a narrow range of frequencies, the most likely culprit is RFI. The first step of the flagging
	recipe then is to look for such signals in Stokes V and flag all the visibilities over the frequencies
	and times they are seen. To do this with <span class="command"><strong>pgflag</strong></span>:
	</p><pre class="programlisting">$ pgflag stokes=i,q,u,v flagpar=8,5,5,3,6,3 "command=&lt;b"</pre><p>
      </p>

      <p>
	This flagging can be done on each individual source after it has been split out. Of course, because
	the output of the interferometer should not vary for Stokes V regardless of the field being observed, you can
	also flag a single IF all together. That is, you can take a dataset output by <span class="command"><strong>uvsplit</strong></span>
	with <em class="parameter"><code>options</code></em>=<code class="option">nosource</code> and flag it directly without further splitting it into
	individual sources. You can also do the flagging before and after calibration. Indeed, you may
	have success in doing an initial round of Stokes V flagging before trying to <span class="command"><strong>mfcal</strong></span>
	the bandpass calibrator, and another round of flagging with the same command after
	calibration.
      </p>

      <p>
	As an illustration, <a class="xref" href="ch04s03.html#flagging_example_unflagged_16cm_short" title="Figure 4.1. A pgflag display showing Stokes V data on a short baseline in a 16cm dataset before flagging.">Figure 4.1</a> and
	<a class="xref" href="ch04s03.html#flagging_example_unflagged_16cm_long" title="Figure 4.2. A pgflag display showing Stokes V data on a long baseline in a 16cm dataset before flagging.">Figure 4.2</a> show what <span class="command"><strong>pgflag</strong></span>
	will display when told to show Stokes V from a dataset centred at 2100 MHz (a typical
	16cm dataset) with fourteen scans on nine different sources, obtained in October 2015.
	Channel number is shown along the horizontal access, and as the 16cm band is presented to the
	correlator as a lower sideband, higher channel numbers correspond to lower frequencies. The time
	of the observation increases along the vertical axis towards the top of the image and the amplitude
	of each channel is represented as a grey scale which is outlined in purple toward the right of the
	image. Flagged regions are shown as completely black.
	<a class="xref" href="ch04s03.html#flagging_example_unflagged_16cm_short" title="Figure 4.1. A pgflag display showing Stokes V data on a short baseline in a 16cm dataset before flagging.">Figure 4.1</a> shows a 60m baseline and
	<a class="xref" href="ch04s03.html#flagging_example_unflagged_16cm_long" title="Figure 4.2. A pgflag display showing Stokes V data on a long baseline in a 16cm dataset before flagging.">Figure 4.2</a> shows a 4469m baseline. The only flagging done to
	this dataset is at the edges to remove the roll-offs, which removes 10.5% of the data on
	each baseline, and the data are uncalibrated. These two figures clearly show how much more sensitive
	short baselines are to RFI than long baselines.
      </p>
      
      <p>
	</p><div class="figure"><a name="flagging_example_unflagged_16cm_short"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_preflagging_short.png" alt="A pgflag display showing Stokes V data on a short baseline in a 16cm dataset before flagging."></div>
	</div><p class="title"><b>Figure 4.1. A <span class="command">pgflag</span> display showing Stokes V data on a short baseline
	  in a 16cm dataset before flagging.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	</p><div class="figure"><a name="flagging_example_unflagged_16cm_long"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_preflagging_long.png" alt="A pgflag display showing Stokes V data on a long baseline in a 16cm dataset before flagging."></div>
	</div><p class="title"><b>Figure 4.2. A <span class="command">pgflag</span> display showing Stokes V data on a long baseline
	  in a 16cm dataset before flagging.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	After using <span class="command"><strong>pgflag</strong></span> as described above on the uncalibrated data, then bandpass
	calibrating and flagging with <span class="command"><strong>pgflag</strong></span> in the same way again, the data on the same
	baselines look like <a class="xref" href="ch04s03.html#flagging_example_flagged_16cm_short" title="Figure 4.3. A pgflag display showing Stokes V data on a short baseline in a 16cm dataset after flagging and bandpass calibration.">Figure 4.3</a> and
	<a class="xref" href="ch04s03.html#flagging_example_flagged_16cm_long" title="Figure 4.4. A pgflag display showing Stokes V data on a long baseline in a 16cm dataset after flagging and bandpass calibration.">Figure 4.4</a>. Approximately 40% of the short baseline
	data is now flagged, and approximately 25% of the long baseline data.
      </p>
      
      <p>
	</p><div class="figure"><a name="flagging_example_flagged_16cm_short"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_postflagging_short.png" alt="A pgflag display showing Stokes V data on a short baseline in a 16cm dataset after flagging and bandpass calibration."></div>
	</div><p class="title"><b>Figure 4.3. A <span class="command">pgflag</span> display showing Stokes V data on a short baseline
	  in a 16cm dataset after flagging and bandpass calibration.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	</p><div class="figure"><a name="flagging_example_flagged_16cm_long"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_postflagging_long.png" alt="A pgflag display showing Stokes V data on a long baseline in a 16cm dataset after flagging and bandpass calibration."></div>
	</div><p class="title"><b>Figure 4.4. A <span class="command">pgflag</span> display showing Stokes V data on a long baseline
	  in a 16cm dataset after flagging and bandpass calibration.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	As you can see, no obviously wrong signals can be identified in Stokes V after this process,
	but that does not necessarily mean that all RFI has been deleted from the data.
	<a class="xref" href="ch04s03.html#flagging_example_flagged_q_16cm_short" title="Figure 4.5. A pgflag display showing Stokes Q data on a short baseline in a 16cm dataset after flagging in Stokes V and bandpass calibration.">Figure 4.5</a> and
	<a class="xref" href="ch04s03.html#flagging_example_flagged_q_16cm_long" title="Figure 4.6. A pgflag display showing Stokes Q data on a long baseline in a 16cm dataset after flagging in Stokes V and bandpass calibration.">Figure 4.6</a> show Stokes Q on the same baselines
	as before, after the Stokes V flagging and bandpass calibration, and further RFI is obvious in
	those figures. We now flag using the linear-polarisation Stokes parameters Q and U.
      </p>

      <p>
	</p><div class="figure"><a name="flagging_example_flagged_q_16cm_short"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_postflagging_q_short.png" alt="A pgflag display showing Stokes Q data on a short baseline in a 16cm dataset after flagging in Stokes V and bandpass calibration."></div>
	</div><p class="title"><b>Figure 4.5. A <span class="command">pgflag</span> display showing Stokes Q data on a short baseline
	  in a 16cm dataset after flagging in Stokes V and bandpass calibration.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	</p><div class="figure"><a name="flagging_example_flagged_q_16cm_long"></a><div class="figure-contents">
	  
	  
	  <div class="mediaobject"><img src="figures/flagex_16cm_postflagging_q_long.png" alt="A pgflag display showing Stokes Q data on a long baseline in a 16cm dataset after flagging in Stokes V and bandpass calibration."></div>
	</div><p class="title"><b>Figure 4.6. A <span class="command">pgflag</span> display showing Stokes Q data on a long baseline
	  in a 16cm dataset after flagging in Stokes V and bandpass calibration.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	To do this we use <span class="command"><strong>pgflag</strong></span> as follows. First, flag Stokes Q:
	</p><pre class="programlisting">$ pgflag stokes=i,v,u,q flagpar=8,2,2,3,6,3 "command=&lt;b"</pre><p>
	And then Stokes U:
	</p><pre class="programlisting">$ pgflag stokes=i,v,q,u flagpar=8,2,2,3,6,3 "command=&lt;b"</pre><p>
	Again, these flagging commands can be done on each source individually, or on the dataset
	as a whole.
      </p>

      <p>
	An example of how effective this flagging recipe can be is shown in
	<a class="xref" href="ch04s03.html#flagging_example_1953_before" title="Figure 4.7. The 16cm spectrum of the source 1953-325 without any flagging.">Figure 4.7</a> and
	<a class="xref" href="ch04s03.html#flagging_example_1953_after" title="Figure 4.8. The 16cm spectrum of the source 1953-325 after automatic flagging with pgflag.">Figure 4.8</a>. Using the calibration solutions
	derived from the flagged dataset, we can compare the 16cm spectrum of the calibrator
	1953-325 before any flagging (<a class="xref" href="ch04s03.html#flagging_example_1953_before" title="Figure 4.7. The 16cm spectrum of the source 1953-325 without any flagging.">Figure 4.7</a>) to
	the spectrum after flagging (<a class="xref" href="ch04s03.html#flagging_example_1953_after" title="Figure 4.8. The 16cm spectrum of the source 1953-325 after automatic flagging with pgflag.">Figure 4.8</a>).
	After the flagging process, only a small amount of RFI remains, and this is not likely to
	cause problems when measuring the continuum spectrum. On the shortest baselines, between
	45-50% of the data has been flagged, but on the baselines to antenna 6 less than 30% of the
	data needed to be flagged. In terms of channels, 1625 of the channels have usable data out
	of the 2049 total channels, representing a spectral coverage loss of approximately 21%.
      </p>
      
      <p>
	</p><div class="figure"><a name="flagging_example_1953_before"></a><div class="figure-contents">
	  
	  <div class="mediaobject"><img src="figures/flagex_1953-325_before.png" alt="The 16cm spectrum of the source 1953-325 without any flagging."></div>
	</div><p class="title"><b>Figure 4.7. The 16cm spectrum of the source 1953-325 without any flagging.</b></p></div><p><br class="figure-break">
      </p>

      <p>
	</p><div class="figure"><a name="flagging_example_1953_after"></a><div class="figure-contents">
	  
	  <div class="mediaobject"><img src="figures/flagex_1953-325_after.png" alt="The 16cm spectrum of the source 1953-325 after automatic flagging with pgflag."></div>
	</div><p class="title"><b>Figure 4.8. The 16cm spectrum of the source 1953-325 after automatic flagging with
	  <span class="command">pgflag</span>.</b></p></div><p><br class="figure-break">
      </p>

    </div>
    
    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Calibration2"></a>4.3.6. Calibration</h3></div></div></div>
      
      <p>
	The calibration strategy for <acronym class="acronym">ATCA</acronym> data has been refined for the <acronym class="acronym">CABB</acronym> era,
	to ensure accurate calibration of wide bandwidths. This strategy also has
	the benefit of being applicable to the vast majority of <acronym class="acronym">ATCA</acronym> data with little
	alteration. It is described best in the
	<a class="ulink" href="http://www.atnf.csiro.au/computing/software/miriad/userguide/node95.html" target="_top">
	  <span class="application">Miriad</span> cookbook</a>, but it will also be summarised here (although
	  not explained in the same depth).
      </p>

      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm46395604841152"></a>4.3.6.1. Bandpass calibration</h4></div></div></div>
	

	<p>
	  Calibration begins by determining the bandpass correction, using <span class="command"><strong>mfcal</strong></span> with
	  your bandpass calibrator. To prevent rapid gain variations from being entangled with your bandpass
	  solution, the <em class="parameter"><code>interval</code></em> parameter should be set to the cycle time (which is
	  usually 0.1 minutes). Since your bandpass calibrator should be very bright, such a short interval
	  should still have plenty of signal-to-noise. By default, <span class="command"><strong>mfcal</strong></span> uses
	  CA03 as the reference antenna, but if that antenna wasn't available during the observations,
	  ensure that you set <em class="parameter"><code>refant</code></em> to be an antenna that was available.
	</p>
	
	<p>
	  If you are reducing 3mm data, and CA02 was available, you should set it as the reference antenna.
	  You should do this because it has the only noise diode in the array at 3mm, and setting it as the
	  reference antenna may make it easier to do polarisation calibration.
	</p>
	
	<div class="informaltable">
	  <table class="informaltable" border="0"><colgroup><col align="left" class="cm"><col align="left" class="mm"></colgroup><thead><tr><th align="left">cm reduction</th><th align="left">mm reduction</th></tr></thead><tbody><tr><td align="left">
		  <pre class="screen">
Task:   mfcal
vis      = 1934-638.2100/
line     =  
stokes   =  
edge     =  
select   =  
flux     =  
refant   =  
minants  =  
interval = 0.1
options  =  
tol      =  
</pre>
		</td><td align="left">
		  <pre class="screen">
Task:   mfcal
vis      = 1921-293.17000/
line     =  
stokes   =  
edge     =  
select   =  
flux     =  
refant   =  
minants  =  
interval = 0.1
options  =  
tol      =  
</pre>
		</td></tr></tbody></table>
	</div>
	
	<p>
	  Bandpass calibration in the cm bands (16 &amp; 4) is usually done with the <acronym class="acronym">ATCA</acronym>
	  primary flux calibrator 1934-638, as it is quite bright at these frequencies. Since the flux
	  density of 1934-638 is known as a function of frequency, the bandpass solution obtained in these
	  bands is very good and takes into account how 1934-638 varies across the band. But if you use another
	  calibrator for which <span class="application">Miriad</span> doesn't have a flux density model, then
	  the bandpass solution will be dependent on how that calibrator's flux density varies with
	  frequency, which is a bad situation. You will need to correct for this, and how to do this
	  correction will be described later on.
	</p>
      </div>
	
      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm46395604825328"></a>4.3.6.2. Gain and polarisation calibration</h4></div></div></div>
	
	<p>
	  After bandpass calibration, the next step is to do some time-variable gain and polarisation
	  calibration. If the bandpass calibrator is 1934-638, or if the bandpass calibrator has been
	  observed several times during the run over a large range of parallactic angle, then you can
	  use it for this step. Otherwise you should use the gain calibrator you observed.
	</p>
	
	<div class="informaltable">
	  <table class="informaltable" border="0"><colgroup><col align="left" class="cm"><col align="left" class="mm"></colgroup><thead><tr><th align="left">cm reduction</th><th align="left">mm reduction</th></tr></thead><tbody><tr><td align="left">
		  <pre class="screen">
Task:   gpcal
vis      = 1934-638.2100/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary
</pre>
		</td><td align="left">
		  <pre class="screen">
Task:   gpcopy
vis      = 1921-293.17000
out      = 2243-123.17000
mode     =  
options  =  

Task:   gpcal
vis      = 2243-123.17000/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve
</pre>
		</td></tr></tbody></table>
	</div>
	
	<p>
	  You should use an <em class="parameter"><code>nfbin</code></em> of at least 2 for all bands. This will
	  allow <span class="command"><strong>gpboot</strong></span> to correct any linear slope errors present in the
	  bandpass table. This also makes it unnecessary to use <span class="command"><strong>mfboot</strong></span>
	  unless your flux calibrator is a planet. You should also increase the
	  <em class="parameter"><code>interval</code></em> parameter if the calibrator is not bright enough to
	  give enough signal-to-noise with 0.1 minutes of integration time.
	</p>
      </div>

      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm46395604811760"></a>4.3.6.3. Flux density calibration</h4></div></div></div>
	

	<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="idm46395604811376"></a>4.3.6.3.1. Calibration in the cm bands</h5></div></div></div>
	  

	  <p>
	    If you used 1934-638 in the <span class="command"><strong>mfcal</strong></span> and <span class="command"><strong>gpcal</strong></span>
	    steps, then you already have a flux calibrated dataset that can be used to
	    fix the flux density scale on the other datasets.
	  </p>

	  <p>
	    You should now copy the solutions from the 1934-638 dataset to the gain calibrator
	    dataset using <span class="command"><strong>gpcopy</strong></span>, and determine the time-variable gains with
	    <span class="command"><strong>gpcal</strong></span>.
	  </p>

	  <pre class="screen">
Task:   gpcopy
vis      = 1934-638.2100/
out      = 2243-123.2100/
mode     =  
options  =

Task:   gpcal
vis      = 2243-123.2100/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve
</pre>

	  <p>
	    The <span class="command"><strong>gpcal</strong></span> step is likely to make the flux density scale on
	    your gain calibrator slightly different to the true scale. To fix this you should
	    use <span class="command"><strong>gpboot</strong></span>.
	  </p>

	  <pre class="screen">
Task:   gpboot
vis      = 2243-123.2100/
cal      = 1934-638.2100/
select   =  
</pre>

	  <p>
	    You can now be confident that your gain calibrator is properly flux calibrated,
	    and can now proceed to use it to analyse your science target.
	  </p>
	</div>
	
	<div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="calibration-in-the-mm-bands"></a>4.3.6.3.2. Calibration in the mm bands</h5></div></div></div>
	  
	  <p>
	    At this point in the mm reduction, you need to do the flux calibration. How this happens
	    depends on whether you're using a planet as the flux calibrator, or 1934-638. After copying
	    the calibration tables from the calibrator used in the <span class="command"><strong>gpcal</strong></span> step
	    to the flux calibrator, you use <span class="command"><strong>gpcal</strong></span> followed by
	    <span class="command"><strong>gpboot</strong></span> if you're using 1934-638, or <span class="command"><strong>mfboot</strong></span> for
	    planets.
	  </p>
	  
	  <div class="informaltable">
	    <table class="informaltable" border="0"><colgroup><col align="left" class="pointsource"><col align="left" class="planet"></colgroup><thead><tr><th align="left">1934-638 flux calibrator</th><th align="left">planetary calibrator</th></tr></thead><tbody><tr><td align="left">
		    <pre class="screen">
Task:   gpcopy
vis      = 2243-123.17000/
out      = 1934-638.17000/
mode     =  
options  =

Task:   gpcal
vis      = 1934-638.17000/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve,nopol

Task:   gpboot
vis      = 2243-123.17000/
cal      = 1934-638.17000/
select   =  
</pre>
		  </td><td align="left">
		    <pre class="screen">
Task:   gpcopy
vis      = 2243-123.33000/
out      = uranus.33000/
mode     =  
options  =

Task:   mfboot
vis      = 2243-123.33000,uranus.33000/
line     =  
select   = source(uranus)
flux     =  
mode     =  
clip     =  
device   = /xs
options  =  
</pre>
		  </td></tr></tbody></table>
	  </div>

	  <p>
	    Note the use of the <code class="option">nopol</code> option for the <em class="parameter"><code>options</code></em>
	    parameter in <span class="command"><strong>gpcal</strong></span>, when 1934-638 is being used as the flux calibrator.
	    This option tells <span class="command"><strong>gpcal</strong></span> that it should accept the leakage solution
	    obtained from the gain calibrator, which should be good since the gain calibrator is likely
	    to have much greater hour-angle coverage than the flux calibrator.
	  </p>

	  <p>
	    In May 2016, <span class="application">Miriad</span>'s high-frequency flux density scale for 1934-638 was
	    changed to align the <acronym class="acronym">ATCA</acronym>'s scale to that of the <acronym class="acronym">VLA</acronym> and the
	    absolute scale used by <span class="emphasis"><em>Planck</em></span>. See <a class="xref" href="ch02s02.html#calibration-flux-density" title="2.2.4. How do I calibrate the flux density of my observations?">Section 2.2.4</a>
	    for details about this new scale. By default, after May 2016, <span class="application">Miriad</span>
	    uses this new scale when setting the flux density of 1934-638 for frequencies above 11 GHz. The flux
	    densities measured from reductions using pre-May 2016 and post-May 2016
	    <span class="application">Miriad</span> will therefore differ for observations above 11 GHz. If you would
	    like to keep using the pre-May 2016 flux density scale for 1934-638, you should use the
	    <code class="option">oldflux</code> option that is available in the <span class="command"><strong>mfcal</strong></span>,
	    and <span class="command"><strong>gpcal</strong></span> commands.
	  </p>
	  
	  <p>
	    At this point the gain calibrator will be reasonably well flux calibrated. If you are
	    not especially concerned about flux calibration accuracy, you can proceed to analyse your
	    science target.
	  </p>

	 <p>
	   If you want to flux calibrate your data as well as possible, then you can use data from
	   the other simultaneously observed band to improve your solution. Basically, the bandpass
	   solution you made earlier assumed that the bandpass calibrator had a constant amplitude
	   with frequency (i.e. a flat-spectrum source). Because of this, the bandpass solution will
	   likely be in error. Our gain solutions with two bins will have corrected this somewhat,
	   but we can also try to emulate the situation in the cm band, and provide
	   <span class="command"><strong>mfcal</strong></span> with a model of the flux density of the bandpass calibrator.
	 </p>

	 <p>
	   To do this, we copy the gain solutions from the gain calibrator back to the bandpass
	   calibrator, recalibrate, and bootstrap the flux density scale.
	 </p>
	 <pre class="screen">
Task:   gpcopy
vis      = 2243-123.17000/
out      = 1921-293.17000/
mode     =  
options  =

Task:   gpcal
vis      = 1921-293.17000/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve,nopol

Task:   gpboot
vis      = 1921-293.17000/
cal      = 2243-123.17000/
select   =  
</pre>
	 <p>
	   Note that these steps don't change regardless of the type of flux calibrator you are
	   using.
	 </p>

	 <p>
	   You should do the same calibration process with the other simultaneously observed band.
	   At the end of the process you should have two bandpass calibrator datasets, each being
	   flux calibrated via the gain calibrator. You can now measure the flux density of the
	   bandpass calibrator over the entire range of observed frequencies, using the
	   <span class="command"><strong>uvfmeas</strong></span> task. The principle here is that even if the slope over
	   a single band is wrong due to the incorrect bandpass calibration assumption, fitting
	   a flux density model using two independently-calibrated bands should lower the
	   uncertainties and provide a very good model of the actual flux density of the source.
	 </p>
	 <pre class="screen">
Task:   uvfmeas
vis      = 1921-293.17000/,1921-293.19000/
select   =  
line     =  
stokes   = i
hann     =  
offset   =  
order    = 1
options  = plotvec,log,mfflux
yrange   =  
device   = /xs
nxy      =  
log      =  
fitp     =  
feval    =  
</pre>

	 <p>
	   The <span class="command"><strong>uvfmeas</strong></span> task does a linear least-squares fit to the
	   log of the vector-averagde Stokes I flux density as a function of the log of the frequency.
	   The plot it makes will show the averaged data in both bands, and the line of best
	   fit (<a class="xref" href="ch04s03.html#uvfmeas-1921-example" title="Figure 4.9.  A plot made using uvfmeas, showing the line of best fit for the flux density model.">Figure 4.9</a>). It will also output a string like:
	 </p>
	 <pre class="screen">
MFCAL flux= 9.4126, 17.0,-0.3801
</pre>

	 <div class="figure"><a name="uvfmeas-1921-example"></a><div class="figure-contents">
	   
	   <div class="mediaobject"><img src="figures/1921-293.uvfmeas.png" alt="A plot made using uvfmeas, showing the line of best fit for the flux density model."></div>
	 </div><p class="title"><b>Figure 4.9. 
	     A plot made using <span class="command">uvfmeas</span>, showing the line of best fit
	     for the flux density model.
	   </b></p></div><br class="figure-break">

	 <p>
	   The string is usable as the <em class="parameter"><code>flux</code></em> in <span class="command"><strong>mfcal</strong></span>,
	   which will fit the bandpass solution while assuming the flux density model we just
	   determined. The image in <a class="xref" href="ch04s03.html#uvfmeas-1921-example" title="Figure 4.9.  A plot made using uvfmeas, showing the line of best fit for the flux density model.">Figure 4.9</a> is actually
	   the result of this two stage process, and you can see the excellent alignment
	   between the two bands, which are independently processed.
	 </p>

	 <p>
	   Once you have measured the flux density model for the bandpass calibrator, you
	   must redo the calibration, but the bandpass calibrator becomes the flux density
	   calibrator. The process is slightly different as well, and is summarised below.
	 </p>

	 <pre class="screen">
Task:   mfcal
vis      = 1921-293.17000/
line     =  
stokes   =  
edge     =  
select   =  
flux     = 9.4126,17.0,-0.3801
refant   =  
minants  =  
interval = 0.1
options  =  
tol      =  

Task:   gpcopy
vis      = 1921-293.17000/
out      = 2243-123.17000/
mode     =  
options  =

Task:   gpcal
vis      = 2243-123.17000/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve

Task:   gpcopy
vis      = 2243-123.17000/
out      = 1921-293.17000/
mode     =  
options  =

Task:   gpcal
vis      = 1921-293.17000/
select   =  
line     =  
flux     =  
refant   =
minants  =  
interval = 0.1
nfbin    = 2  
tol      =  
xyphase  =  
options  = xyvary,qusolve,nopol

Task:   gpboot
vis      = 2243-123.17000/
cal      = 1921-293.17000/
select   =  

Task:   mfboot
vis      = 2243-123.17000,1921-293.17000/
line     =  
select   = source(1921-293)
flux     = 9.4126,17.0,-0.3801
mode     =  
clip     =  
device   = /xs
options  =  
</pre>

	 <p>
	   At this point both the bandpass and gain calibrator datasets will be very accurately
	   flux calibrated. Simulations suggest that this two-stage process can improve the flux
	   calibration accuracy to the 1% level for the bandpass calibrator, and to around the
	   3% level for any other calibrators referenced to it. Observations have confirmed this
	   in the 15mm band, while for the 7mm band the flux calibration accuracy for an arbitrary gain
	   calibrator is around 10%.
	 </p>
	</div>
      </div>

      <div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="idm46395604763536"></a>4.3.6.4. General advice</h4></div></div></div>
	

	<p>
	  The calibration technique outlined above is robust and generally applicable, but may not
	  work adequately for your data without alteration, and will almost certainly not work in
	  an automated fashion. You should always be prepared to iterate between flagging and
	  calibration, and you should use the visualisation tasks <span class="command"><strong>uvplt</strong></span>,
	  <span class="command"><strong>uvspec</strong></span> and <span class="command"><strong>closure</strong></span> to check that the calibrator
	  visibilities look as they should. You can also look at the calibration solutions directly
	  using the <span class="command"><strong>gpplt</strong></span> task. Using <span class="command"><strong>uvfmeas</strong></span> to view the
	  calibrators in both simultaneously-observed bands may also give you confidence that your
	  calibration is good, or otherwise.
	</p>
      </div>
    </div>

    <div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="Imaging"></a>4.3.7. Imaging</h3></div></div></div>
      
      <p>
	Imaging of <acronym class="acronym">CABB</acronym> data can be performed in exactly the same way as pre-<acronym class="acronym">CABB</acronym> data,
	however you may get better results with a slightly different method.
      </p>

      <p>
	For high-frequency observations, where a bandwidth of 2 GHz does not represent
	a very large fraction of the sky frequency, then the imaging strategy used for
	pre-<acronym class="acronym">CABB</acronym> data will most likely be adequate. For lower frequencies the
	multi-frequency strategies are more likely to produce good results. In particular,
	the use of the <span class="command"><strong>mfclean</strong></span> task should be considered. Read the excellent
	description of why <span class="command"><strong>mfclean</strong></span> is necessary
	<a class="ulink" href="http://www.atnf.csiro.au/computing/software/miriad/userguide/node110.html" target="_top">
	  in the <span class="application">Miriad</span> cookbook</a>
	to see if you will need to proceed with this strategy.
      </p>

      <p>
	If you don't need <span class="command"><strong>mfclean</strong></span> then you should proceed with the usual
	<span class="command"><strong>invert</strong></span>, <span class="command"><strong>clean</strong></span> and <span class="command"><strong>restor</strong></span> 
	method of creating an image, and combine
	this with <span class="command"><strong>selfcal</strong></span> or <span class="command"><strong>gpscal</strong></span> if 
	appropriate. In this case, nothing should be different
	from pre-<acronym class="acronym">CABB</acronym> reduction.
      </p>

      <p>
	If you do need <span class="command"><strong>mfclean</strong></span> then the inputs to <span class="command"><strong>invert</strong></span> will need to be
	slightly different as well. Firstly, both the <code class="option">mfs</code> and <code class="option">sdb</code>
	options will need to be passed to <span class="command"><strong>invert</strong></span>. <span class="command"><strong>mfclean</strong></span> also requires
	that the beam be three times the size of the region being cleaned, which can be quickly specified
	in the latest version of <span class="application">Miriad</span> in the <em class="parameter"><code>imsize</code></em>.
      </p>

      <pre class="screen">
Task:   invert
vis      = obs.uv
map      = obs.map
beam     = obs.beam
imsize   = 3,3,beam
cell     = 
offset   =
fwhm     = 
sup      = 
robust   = 0.5
line     =
ref      =
select   = 
stokes   = i
options  = mfs,sdb
mode     =
slop     =
</pre>
      <p>
	The first two options to the <em class="parameter"><code>imsize</code></em> parameter are usually the
	number of pixels in the x and y direction respectively that the image will have. But when
	you specify the <code class="option">beam</code> option as the third argument to
	<em class="parameter"><code>imsize</code></em>, the first two options are interpreted as multiples of the
	FWHM of the primary beam at the central frequency of the image. In the example above, both the
	dirty image and the synthesised beam image would cover 3 times the primary beam FWHM in each 
	direction. In earlier versions
	of <span class="application">Miriad</span>, both the <em class="parameter"><code>imsize</code></em> and
	<em class="parameter"><code>cell</code></em> parameters would have needed to be determined manually and
	explicitly set to do the same thing.
      </p>

      <p>
	With the synthesised beam covering 3 times the primary beam FWHM,
	<span class="command"><strong>mfclean</strong></span> can be used to clean the entire primary beam.
      </p>
      <pre class="screen">
Task:   mfclean
map      = obs.map
beam     = obs.beam
model    =
out      = obs.clean
gain     =
cutoff   =
niters   =
region   = percentage(33)
minpatch =
speed    =
mode     =
log      =
</pre>
      <p>
	Here we are selecting the central third of the image (the primary beam
	area) with the <em class="parameter"><code>region</code></em> keyword. This also satisfies the
	<span class="command"><strong>mfclean</strong></span> requirement that a guard band be present around the
	region being cleaned. The other parameters are very similar to those
	of <span class="command"><strong>clean</strong></span> and should be set as usual to obtain good results.
      </p>

      <p>
	After <span class="command"><strong>mfclean</strong></span> has run, <span class="command"><strong>restor</strong></span> should be used in the normal
	way to produce the cleaned image. <span class="command"><strong>selfcal</strong></span> can also be used in the
	usual fashion in this process.
      </p>
    </div>
  </div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch04.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch04s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.2. Report Your Experiences </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 4.4. Publishing Results</td></tr></table></div></body></html>
