<chapter id="After-your-Observations">
  <info>
    <title>After your Observations</title>
    <date>$Date: 2016-05-09 10:42:02 +1000 (Mon, 09 May 2016) $</date>
    <revhistory>
      <revision>
	<revnumber>1.3</revnumber>
	<date>2015 Nov 19</date>
	<authorinitials>jbs</authorinitials>
	<revremark>
	  Describe pgflag and how to use it as an automatic flagger, with examples.
	</revremark>
      </revision>
      <revision>
	<revnumber>1.2</revnumber>
	<date>2015 Oct 21</date>
	<authorinitials>jbs</authorinitials>
	<revremark>
	  Removed section on portable hard drives, and recognised that CABB
	  has been around for a long time now.
	</revremark>
      </revision>
      <revision>
	<revnumber>1.1</revnumber>
	<date>2014 Mar 24</date>
	<authorinitials>jbs</authorinitials>
	<revremark>
	  Revised to bring it up to date, and more detail
	  in the data reduction section.
	</revremark>
      </revision>
      <revision>
	<revnumber>1.0</revnumber>
	<date>2014 Mar 20</date>
	<authorinitials>jbs</authorinitials>
	<revremark>Initial Docbook revision</revremark>
      </revision>
    </revhistory>
  </info>
  <section id="Archiving-Your-Data">
    <info>
      <title>Archiving Your Data</title>
    </info>
    <para>
      There are several means for you to obtain a copy of your data once you
      have finished your observations. The following subsections will describe
      these methods in detail.
    </para>

    <para>
      You are requested to make a copy of your data as soon as possible after
      the observations.
    </para>

    <section id="Laptop">
      <info>
	<title>Laptop</title>
      </info>
      <para>
	You can copy your data to your laptop from the Marsfield <acronym>SOC</acronym>.
	When your laptop is plugged
	in to a pink cable, you will have to use an SSH tunnel through <hardware>venice</hardware>
	to access the area on <hardware>kaputar</hardware> where your data resides.
      </para>

      <para>
	To set up the SSH tunnel, type the following in a terminal on your
	computer:
	<programlisting>$ ssh -L 2222:kaputar:22 usr123@venice.atnf.csiro.au</programlisting>
      </para>

      <para>
	This makes all traffic directed at port 2222 on your computer get transported
	through <hardware>venice</hardware> to <hardware>kaputar</hardware> via the usual SSH/SCP port of 22. This
	tunnel will exist as long as you remain logged into <hardware>venice</hardware> in this
	terminal. Thus to copy your data across, type the following in another terminal:
	<programlisting>$ scp -P 2222 &#x201C;usr123@localhost:/data/ARCHIVE_1/ATCA/archive/*.CX167&#x201D; .</programlisting>
      </para>

      <para>
	which would copy all project CX167 data, and where <literal>usr123</literal> is
	your <acronym>ATNF</acronym> username.
      </para>

      <para>
	If you are a <acronym>CSIRO</acronym> staff member and can connect your laptop directly to
	the <acronym>ATNF</acronym> network via a blue cable, you may copy the data directly from
	<hardware>kaputar</hardware>:
	<programlisting>$ scp &#x201C;usr123@kaputar:/data/ARCHIVE_1/ATCA/archive/*.CX167&#x201D; .</programlisting>
      </para>
    </section>

    <section id="Online-Archive">
      <info>
        <title>Online Archive</title>
      </info>
      <para>
	Your <acronym>CABB</acronym> data will appear on the
	<ulink url="http://atoa.atnf.csiro.au">Australia Telescope Online Archive</ulink>
	(<acronym>ATOA</acronym>) within a few days of your observations.
	Using the <acronym>OPAL</acronym> account you
	used to submit your successful proposal, you will have access to your
	data. Full instructions for how to use the archive interface are
	available on the website.
      </para>
    </section>

    <section id="Remote-Copy">
      <info>
        <title>Remote Copy</title>
      </info>

      <para>
	If you are unable to get your data from the <acronym>ATOA</acronym> as soon as you would
	like, then you may get it directly from the disk on <hardware>kaputar</hardware> that
	buffers the data.
      </para>

      <para>
	To do this, you must set up an SSH tunnel from your local machine to
	<hardware>kaputar</hardware> via the <acronym>ATNF</acronym> gateway machine <hardware>venice</hardware>. This can be set
	up with the command:
	<programlisting>$ ssh -L 2222:kaputar:22 usr123@venice.atnf.csiro.au</programlisting>
	where <literal>usr123</literal> is your <acronym>ATNF</acronym> username. This will log you into
	<hardware>venice</hardware> and set up the SSH tunnel, which will remain until you
	log out. To copy data from <hardware>kaputar</hardware>
	you should go to another terminal and do something like:
	<programlisting>$ scp -P 2222 &#x201C;usr123@localhost:/data/ARCHIVE_1/ATCA/archive/*.CX167&#x201D; .</programlisting>
      </para>
    </section>
  </section>

  <section id="Report-Your-Experiences">
    <info>
      <title>Report Your Experiences</title>
    </info>
    <para>
      After your observations, please provide us with feedback by completing
      the online
      <ulink url="http://www.narrabri.atnf.csiro.au/feedback">Observer's Questionnaire</ulink>.
      The feedback you give provides us with a way of measuring the success or failure of
      Compact Array operations, and allows us to identify areas that need
      attention.
    </para>

    <para>
      If you can't find the information you require in this Users Guide and would like to
      ask our expert users how to do something, please visit the 
      <ulink url="http://atcaforum.atnf.csiro.au"><acronym>ATCA</acronym> Forum website</ulink>.You 
      can also start or participate in conversations about your experiences with the <acronym>ATCA</acronym>.
    </para>
  </section>

  <section id="Data-Analysis">
    <info>
      <title>Data Analysis</title>
    </info>
    <para>
      This section will describe how to get started on reducing <acronym>CABB</acronym> data
      using the <application>Miriad</application> software suite. More information can be found
      in the 
      <ulink url="http://www.atnf.csiro.au/computing/software/miriad"><application>Miriad</application> manual</ulink>.
      The manual's cookbook should be read by all users before starting
      their first data reduction. This section will summarise how reduction
      differs for <acronym>CABB</acronym> data, and give a reasonable guide on how to do a
      simple continuum reduction. The <application>Miriad</application> manual has been updated to
      incorporate information on <acronym>CABB</acronym> data reduction, but work continues on
      improving it.
    </para>

    <section id="Updating-Miriad">
      <info>
        <title>Updating <application>Miriad</application></title>
      </info>

      <para>
	<application>Miriad</application> development is ongoing, in order to fix bugs and introduce
	new features useful for <acronym>ATCA</acronym> data reduction. It is therefore important that
	before beginning your data reduction that you
	obtain the very latest <application>Miriad</application> distribution, as new features may have
	been implemented that will make your reduction easier or more successful, or
	may solve an issue that you were experiencing with an older version of
	<application>Miriad</application>.
      </para>

      <para>
	To get the latest <application>Miriad</application> distribution, please follow the instructions
	<ulink url="http://www.atnf.csiro.au/computing/software/miriad/INSTALL.html">in the install guide</ulink>.
      </para>

      <para>
	It is also important to report any problems you may have with your reduction
	to the <application>Miriad</application> maintenance team so that any issues can be resolved. If
	you experience any problems, please use the <command>mirbug</command> routine, or send an
	email describing your problem to <email>miriad@atnf.csiro.au</email>. If you don't
	think your problem is related to a bug, but you need advice on how best to
	proceed with your reduction, please ask for help using the 
	<ulink url="http://atcaforum.atnf.csiro.au"><acronym>ATCA</acronym> Forum</ulink>.
	<acronym>ATCA</acronym> and <acronym>ATNF</acronym> staff routinely check
	the forum and answer questions from the community, making the forum a good
	place to start to look for answers as well.
      </para>
    </section>

    <section id="Loading-Data">
      <info>
	<title>Loading Data</title>
      </info>
      <para>
	Data files from <acronym>CABB</acronym> are much larger than those generated by the old
	correlator, so it is recommended that you process them on a machine with
	plenty of physical memory (RAM). If you rely on virtual memory to work with
	<acronym>CABB</acronym> data files, then you will experience very poor performance.
      </para>

      <para>
	To load <acronym>CABB</acronym> data, you will use the <command>atlod</command> task. The inputs to this task
	should, in general, be the same as for pre-<acronym>CABB</acronym> data. However there are two
	options that should be used for all <acronym>CABB</acronym> data to make subsequent reduction
	more pleasant. These two options are <option>birdie</option> and <option>rfiflag</option>.
      </para>

      <para>
	The <option>birdie</option> option was always recommended for pre-<acronym>CABB</acronym> data, but
	for a different reason. For <acronym>CABB</acronym> data, a number of channels are affected
	by self-generated interference from the 640 MHz <acronym>CABB</acronym> clock, and the
	<option>birdie</option> option flags these channels during load. It also flags out
	4.9% of channels on each band edge (which works out to be 100 channels for <acronym>CABB</acronym>'s
	2049 channel spectra) and, for 20/13cm data taken before 2010-Aug-17, the unusable parts of the spectrum in
	the old, separate 20cm and 13cm bands. These unusable parts are due to the fact that these
	receivers did not respond to all frequencies across the 2 GHz bandwidth of
	<acronym>CABB</acronym>. This option still works for pre-<acronym>CABB</acronym> data as expected.
      </para>

      <para>
	If you wish to change the number of edge channels that are flagged by the <option>birdie</option>
	option, use the <parameter>edge</parameter> parameter in <command>atlod</command>. By default it is
	set to 9.8 (per cent), which works out to 200 channels for a 2049 channel spectrum. These flagged
	channels are split evenly to the top and bottom of the spectrum, so if you wanted to flag only 32
	channels on each band edge for example, you should specify
	<parameter>edge</parameter>=<option>3.1</option>.
      </para>

      <para>
	The <option>rfiflag</option> option can be used now to automatically flag out
	frequency bands that are known to be heavily affected by RFI.
	This option is most useful in the 16cm band, where the <acronym>ATCA</acronym>
	receivers are routinely affected by strong RFI. It is completely safe to use at
	any band however, and should be included in the default list of options when you
	use <command>atlod</command>. The file it uses to determine the flagging it performs can be
	customised to include extra flagging (or less flagging) if so desired. By default,
	this file (called <filename>rfiflag.txt</filename>) can be found in the directory
	<filename class="directory">cat</filename> in the <application>Miriad</application> tree. 
	To customise it, copy it to your reduction
	directory, insert or remove more frequency ranges to flag, and then load your
	data with <command>atlod</command>.
      </para>

      <para>
	Note that the
	<option>rfiflag</option> option will have no effect if the <option>birdie</option> option
	is not also specified.
      </para>

      <para>
	Another useful <command>atlod</command> option is <option>xycorr</option>. This corrects the
	measured XY phase of the <acronym>ATCA</acronym>, and can be safely included at all bands for
	<acronym>CABB</acronym> data.
      </para>

      <para>
	By default, <acronym>CABB</acronym> records the autocorrelations from each of the antenna that
	are being used, which may not be useful if all you are interested in is the
	cross-correlations required to make an image. Having the autocorrelations
	present during the reduction does no harm to any of the <application>Miriad</application> routines,
	but may become confusing and/or annoying when trying to examine the data. You
	can make <command>atlod</command> discard these data by using the <option>noauto</option> option.
      </para>

      <para>
	The other <command>atlod</command> options are usually frequency dependent. Examples of
	<command>atlod</command> use are given below for all <acronym>ATCA</acronym> bands.
      </para>
      <variablelist>
	<varlistentry>
	  <term><emphasis role="bold">16cm band</emphasis></term>
	  <listitem>
	    <screen>
	      Task:   atlod
	      in       = *.C007
	      out      = c007.uv
	      ifsel    = 1
	      restfreq =
	      options  = birdie,xycorr,rfiflag,noauto
	      nfiles   =
	      nscans   =
	      nopcorr  =
	      edge     =
	    </screen>
	    <para>
	      For this band, if you used identical centre frequencies in both IFs,
	      you need only extract one of them as both IFs will contain
	      identical data, and keeping both may lead to confusion later on.
	    </para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><emphasis role="bold">4cm band</emphasis></term>
	  <listitem>
	    <screen>
	      Task:   atlod
	      in       = *.C007
	      out      = c007.uv
	      ifsel    = 
	      restfreq =
	      options  = birdie,xycorr,rfiflag,noauto
	      nfiles   =
	      nscans   =
	      nopcorr  =
	      edge     =
	    </screen>
	    <para>
	      If you chose to use the same centre frequency for both IFs then you should
	      extract only 1 IF using the <parameter>ifsel</parameter> parameter as described above.
	    </para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><emphasis role="bold">15mm &amp; 7mm bands</emphasis></term>
	  <listitem>
	    <screen>
	      Task:   atlod
	      in       = *.C007
	      out      = c007.uv
	      ifsel    = 
	      restfreq =
	      options  = birdie,xycorr,rfiflag,opcorr,noauto
	      nfiles   =
	      nscans   =
	      nopcorr  =
	      edge     =
	    </screen>
	    <para>
	      At these mm bands, you should include the <option>opcorr</option> option to
	      correct for atmospheric opacity. If you observed at frequencies where the
	      atmospheric opacity varies quickly as a function of frequency (for example,
	      near the water line at 22 GHz), then you should set the
	      <parameter>nopcorr</parameter> parameter to allow multiple opacity correction
	      factors across the band, up to a maximum of 32 bins.
	    </para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><emphasis role="bold">3mm band</emphasis></term>
	  <listitem>
	    <screen>
	      Task:   atlod
	      in       = *.C007
	      out      = c007.uv
	      ifsel    = 
	      restfreq =
	      options  = birdie,xycorr,rfiflag,noauto
	      nfiles   =
	      nscans   =
	      nopcorr  =
	      edge     =
	    </screen>
	  </listitem>
	</varlistentry>
      </variablelist>
    </section>
    
    <section id="Correcting-mm-data">
      <info>
        <title>Correcting mm data</title>
      </info>
      <para>
	For higher frequency data, the <command>atfix</command> routine may be required to apply
	corrections to the antenna positions and system temperature measurements.
      </para>

      <para>
	During a baseline reconfiguration at the <acronym>ATCA</acronym>, staff perform a baseline
	calibration (to determine precisely where each antenna is with respect to each other) at 5 GHz and
	17 GHz. During normal observing, the solution determined at 5 GHz is applied
	on-line, and is usually very good. However, for mm data, you may wish to use
	more precise antenna positions obtained from the 17 GHz baseline calibration.
	This may aid in phase referencing experiments.
      </para>

      <para>
	The <command>atfix</command> routine can &#x201C;fix&#x201D; the positions of the <acronym>ATCA</acronym> antennas based
	on the solution file that is made available by the <acronym>ATCA</acronym> staff on the
	<ulink url="http://www.narrabri.atnf.csiro.au/observing/antpos/">
	  baseline solutions page</ulink>. 
	  The high-frequency baseline solutions are not routinely computed for each reconfiguration, so
	  if you'd like to have one, please contact <acronym>ATCA</acronym> staff with your request.
      </para>

      <para>
	The task <command>atfix</command> is also highly recommended for the reduction of 3mm data.
	During an observation at 3mm, the system temperature is determined using the
	paddle during a so-called &#x201C;paddle scan&#x201D;. These scans are usually tens of
	minutes apart, during which time the system temperature recorded by the
	correlator does not change. To make <application>Miriad</application> interpolate the system
	temperature between the paddle scans, use <command>atfix</command> with default parameters,
	or with <parameter>tsyscal</parameter>=<option>interpolate</option> explictly set.
      </para>
      <screen>
	Task:   atfix
	vis      = 3mm_data.uv
	select   =
	out      = 3mm_data_fixed.uv
	dantpos  = 
	tsyscal  =
	options  =
	array    =
      </screen>
    </section>

    <section id="Splitting-the-dataset">
      <info>
        <title>Splitting the dataset</title>
      </info>
      <para>
	After loading the data into a <application>Miriad</application> dataset, it is usually most
	convenient to split this into many datasets, each containing an individual
	source at a single central frequency. This is done using the uvsplit
	task.
      </para>

      <para>
	At its simplest, it can be run with only the <parameter>vis</parameter> parameter set to
	the parent dataset, but it is also very easy to use the <parameter>select</parameter> parameter
	here to discard data that was affected by antenna shadowing:
      </para>
      <screen>
	Task:   uvsplit
	vis      = c007.uv
	select   = -shadow(22.5)
	options  =
	maxwidth =
      </screen>
      <para>
	The <parameter>select</parameter> keyword can also be used to split out only certain sources,
	or to effectively flag out certain antenna. Read about the <parameter>select</parameter>
	keyword 
	<ulink url="http://www.atnf.csiro.au/computing/software/miriad/doc/select.html">
	  in the <application>Miriad</application> manual</ulink>.
      </para>

      <para>
	There are two options that are useful here. Specify the
	<option>mosaic</option> option if you are splitting a dataset that contains a mosaic
	observation, and specify the <option>clobber</option> option if you want to overwrite
	any previously split-out datasets in the current directory.
      </para>

      <para>
	The <parameter>maxwidth</parameter> parameter is new to the <acronym>CABB</acronym> era, and allows you to
	break up the 2 GHz <acronym>CABB</acronym> bandwidth into smaller chunks. This will be most useful
	at lower frequencies where 2 GHz represents a large fractional bandwidth. At
	such frequencies, calibration and imaging is far more challenging than at higher
	frequencies. The bandwidth specified here should be specified in GHz. For example,
	to mimic the maximum bandwidth available from the old correlator, you could
	specify <parameter>maxwidth</parameter>=<option>0.128</option> here. Recent experience shows
	however that excellent calibration can be obtained using the entire 2 GHz band simultaneously, even
	in the 16cm band. Splitting up the band at this point then is only recommended for those who have
	an actual need to do so.
      </para>
    </section>

    <section id="Flagging">
      <info>
        <title>Flagging</title>
      </info>
      <para>
	In most cases, if the <option>birdie</option> and <option>rfiflag</option> options are given
	to <command>atlod</command>, the data will be mostly free from RFI at this point. However,
	you should always examine your data with the <command>uvplt</command> and <command>uvspec</command> tasks
	to make sure.
	<indexterm role="cp"><primary>interference</primary><secondary>flagging</secondary>
	<tertiary>data reduction</tertiary></indexterm>
      </para>

      <para>
	Using <command>uvplt</command>, examining amplitude and phase versus time is a good way to
	find time ranges that have been affected by RFI. Ensure that you specify
	<parameter>options</parameter>=<option>nofqav</option> to prevent <command>uvplt</command> from averaging your data over
	frequency before plotting. Any RFI present in your observations may
	be restricted to only a few channels, and these channels can be identified
	by using <command>uvspec</command>.
      </para>

      <para>
	To flag this data, you can use the following tasks.
      </para>
      <variablelist>
	<varlistentry>
	  <term><command>uvflag</command></term>
	  <listitem>
	    <para>
	      <indexterm role="cp"><primary>interference</primary><secondary>flagging</secondary>
	      <tertiary>uvflag</tertiary></indexterm>
	      Use the <parameter>select</parameter> and <parameter>line</parameter> keywords to select the bad data
	      and set <parameter>flagval</parameter>=<option>flag</option> to flag the data as bad.
	      <command>uvflag</command> can be used to flag any set of bad data, but can be tediously repetitive.
	    </para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><command>blflag</command></term>
	  <listitem>
	    <para>
	      <indexterm role="cp"><primary>interference</primary><secondary>flagging</secondary>
	      <tertiary>blflag</tertiary></indexterm>
	      This task can replicate many of the plots that <command>uvplt</command> generates, which
	      may allow you to directly select the outliers representing bad data.
	    </para>
	  </listitem>
	</varlistentry>
	<varlistentry>
	  <term><command>pgflag</command></term>
	  <listitem>
	    <para>
	      <indexterm role="cp"><primary>interference</primary><secondary>flagging</secondary>
	      <tertiary>pgflag</tertiary></indexterm>
	      This task replaces the old <command>tvflag</command> task that no longer works on
	      displays with more than an 8-bit colour depth. <command>pgflag</command> displays data as
	      a channel-time waterfall plot and allows direct selection of ranges of bad
	      data and flexible flagging options. It also includes an automatic flagging routine
	      that uses the <firstterm>SumThreshold</firstterm> method that is available in the
	      <ulink url="http://sourceforge.net/p/aoflagger/wiki/Home/"><application>AOFlagger</application></ulink>, and is
	      highly recommended for use during continuum reductions.
	    </para>
	  </listitem>
	</varlistentry>
      </variablelist>

      <para>
	One trap that you may find is that if you are observing at 3mm and some other band in the
	same run, and you elected to keep CA06 tracking for the 3mm observations, the data from CA06
	will not automatically be flagged. This is because CA06 has almost all the systems required for
	3mm observing (save for the electronics), and so the antenna really is &#x201C;on source&#x201D;
	according to the telescope. You should use <command>uvflag</command> to flag out CA06 data in
	this case.
      </para>

      <para>
	<indexterm role="cp"><primary>interference</primary><secondary>flagging</secondary>
	<tertiary>pgflag</tertiary></indexterm>
	Automatic flagging with <command>pgflag</command> can be very effective if it is done in
	the right way. It is most useful for continuum observations in any band, and for spectral line
	observations when the line is not detectable in a single integration. If your spectral line
	is bright enough to be detected in a single integration, then the flagging routine will likely
	identify it as RFI.
      </para>

      <para>
	The <command>pgflag</command> task accepts a number of parameters that control the automatic
	flagging process. Craig Anderson identified, through trial and error, a recipe that works
	quite well for 16cm data; this recipe is described in
	<ulink url="https://atcaforum.atnf.csiro.au/viewtopic.php?f=10&amp;t=167">
	  an ATCA Forum post Craig started</ulink>. We describe this recipe here as well, and we
	  recommend this recipe for data in any band.
      </para>

      <para>
	This flagging recipe uses the concept that the polarisation properties of interference are
	quite different to that of the signals we're interested in. For the most part, the radio
	sky is free of discrete sources of circular polarisation, and thus most measurements of Stokes V from our
	interferometer should be thermal noise only. This assumption holds over all frequencies as well.
	So if we see a large deviation from thermal noise in Stokes V, and this deviation is confined to
	a narrow range of frequencies, the most likely culprit is RFI. The first step of the flagging
	recipe then is to look for such signals in Stokes V and flag all the visibilities over the frequencies
	and times they are seen. To do this with <command>pgflag</command>:
	<programlisting>$ pgflag stokes=i,q,u,v flagpar=8,5,5,3,6,3 "command=&lt;b"</programlisting>
      </para>

      <para>
	This flagging can be done on each individual source after it has been split out. Of course, because
	the output of the interferometer should not vary for Stokes V regardless of the field being observed, you can
	also flag a single IF all together. That is, you can take a dataset output by <command>uvsplit</command>
	with <parameter>options</parameter>=<option>nosource</option> and flag it directly without further splitting it into
	individual sources. You can also do the flagging before and after calibration. Indeed, you may
	have success in doing an initial round of Stokes V flagging before trying to <command>mfcal</command>
	the bandpass calibrator, and another round of flagging with the same command after
	calibration.
      </para>

      <para>
	As an illustration, <xref linkend="flagging_example_unflagged_16cm_short"></xref> and
	<xref linkend="flagging_example_unflagged_16cm_long"></xref> show what <command>pgflag</command>
	will display when told to show Stokes V from a dataset centred at 2100 MHz (a typical
	16cm dataset) with fourteen scans on nine different sources, obtained in October 2015.
	Channel number is shown along the horizontal access, and as the 16cm band is presented to the
	correlator as a lower sideband, higher channel numbers correspond to lower frequencies. The time
	of the observation increases along the vertical axis towards the top of the image and the amplitude
	of each channel is represented as a grey scale which is outlined in purple toward the right of the
	image. Flagged regions are shown as completely black.
	<xref linkend="flagging_example_unflagged_16cm_short"></xref> shows a 60m baseline and
	<xref linkend="flagging_example_unflagged_16cm_long"></xref> shows a 4469m baseline. The only flagging done to
	this dataset is at the edges to remove the roll-offs, which removes 10.5% of the data on
	each baseline, and the data are uncalibrated. These two figures clearly show how much more sensitive
	short baselines are to RFI than long baselines.
      </para>
      
      <para>
	<figure id="flagging_example_unflagged_16cm_short">
	  <title>A <command>pgflag</command> display showing Stokes V data on a short baseline
	  in a 16cm dataset before flagging.</title>
	  <titleabbrev><command>pgflag</command> showing unflagged Stokes V on a short baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_preflagging_short.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	<figure id="flagging_example_unflagged_16cm_long">
	  <title>A <command>pgflag</command> display showing Stokes V data on a long baseline
	  in a 16cm dataset before flagging.</title>
	  <titleabbrev><command>pgflag</command> showing unflagged Stokes V on a long baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_preflagging_long.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	After using <command>pgflag</command> as described above on the uncalibrated data, then bandpass
	calibrating and flagging with <command>pgflag</command> in the same way again, the data on the same
	baselines look like <xref linkend="flagging_example_flagged_16cm_short"></xref> and
	<xref linkend="flagging_example_flagged_16cm_long"></xref>. Approximately 40% of the short baseline
	data is now flagged, and approximately 25% of the long baseline data.
      </para>
      
      <para>
	<figure id="flagging_example_flagged_16cm_short">
	  <title>A <command>pgflag</command> display showing Stokes V data on a short baseline
	  in a 16cm dataset after flagging and bandpass calibration.</title>
	  <titleabbrev><command>pgflag</command> showing flagged Stokes V on a short baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_postflagging_short.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	<figure id="flagging_example_flagged_16cm_long">
	  <title>A <command>pgflag</command> display showing Stokes V data on a long baseline
	  in a 16cm dataset after flagging and bandpass calibration.</title>
	  <titleabbrev><command>pgflag</command> showing flagged Stokes V on a long baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_postflagging_long.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	As you can see, no obviously wrong signals can be identified in Stokes V after this process,
	but that does not necessarily mean that all RFI has been deleted from the data.
	<xref linkend="flagging_example_flagged_q_16cm_short"></xref> and
	<xref linkend="flagging_example_flagged_q_16cm_long"></xref> show Stokes Q on the same baselines
	as before, after the Stokes V flagging and bandpass calibration, and further RFI is obvious in
	those figures. We now flag using the linear-polarisation Stokes parameters Q and U.
      </para>

      <para>
	<figure id="flagging_example_flagged_q_16cm_short">
	  <title>A <command>pgflag</command> display showing Stokes Q data on a short baseline
	  in a 16cm dataset after flagging in Stokes V and bandpass calibration.</title>
	  <titleabbrev><command>pgflag</command> showing unflagged Stokes Q on a short baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_postflagging_q_short.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	<figure id="flagging_example_flagged_q_16cm_long">
	  <title>A <command>pgflag</command> display showing Stokes Q data on a long baseline
	  in a 16cm dataset after flagging in Stokes V and bandpass calibration.</title>
	  <titleabbrev><command>pgflag</command> showing unflagged Stokes Q on a long baseline.</titleabbrev>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_16cm_postflagging_q_long.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	To do this we use <command>pgflag</command> as follows. First, flag Stokes Q:
	<programlisting>$ pgflag stokes=i,v,u,q flagpar=8,2,2,3,6,3 "command=&lt;b"</programlisting>
	And then Stokes U:
	<programlisting>$ pgflag stokes=i,v,q,u flagpar=8,2,2,3,6,3 "command=&lt;b"</programlisting>
	Again, these flagging commands can be done on each source individually, or on the dataset
	as a whole.
      </para>

      <para>
	An example of how effective this flagging recipe can be is shown in
	<xref linkend="flagging_example_1953_before"></xref> and
	<xref linkend="flagging_example_1953_after"></xref>. Using the calibration solutions
	derived from the flagged dataset, we can compare the 16cm spectrum of the calibrator
	1953-325 before any flagging (<xref linkend="flagging_example_1953_before"></xref>) to
	the spectrum after flagging (<xref linkend="flagging_example_1953_after"></xref>).
	After the flagging process, only a small amount of RFI remains, and this is not likely to
	cause problems when measuring the continuum spectrum. On the shortest baselines, between
	45-50% of the data has been flagged, but on the baselines to antenna 6 less than 30% of the
	data needed to be flagged. In terms of channels, 1625 of the channels have usable data out
	of the 2049 total channels, representing a spectral coverage loss of approximately 21%.
      </para>
      
      <para>
	<figure id="flagging_example_1953_before">
	  <title>The 16cm spectrum of the source 1953-325 without any flagging.</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_1953-325_before.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

      <para>
	<figure id="flagging_example_1953_after">
	  <title>The 16cm spectrum of the source 1953-325 after automatic flagging with
	  <command>pgflag</command>.</title>
	  <mediaobject>
	    <imageobject>
	      <imagedata fileref="figures/flagex_1953-325_after.png" format="PNG"></imagedata>
	    </imageobject>
	  </mediaobject>
	</figure>
      </para>

    </section>
    
    <section id="Calibration2">
      <info>
        <title>Calibration</title>
      </info>
      <para>
	The calibration strategy for <acronym>ATCA</acronym> data has been refined for the <acronym>CABB</acronym> era,
	to ensure accurate calibration of wide bandwidths. This strategy also has
	the benefit of being applicable to the vast majority of <acronym>ATCA</acronym> data with little
	alteration. It is described best in the
	<ulink url="http://www.atnf.csiro.au/computing/software/miriad/userguide/node95.html">
	  <application>Miriad</application> cookbook</ulink>, but it will also be summarised here (although
	  not explained in the same depth).
      </para>

      <section>
	<info>
	  <title>Bandpass calibration</title>
	</info>

	<para>
	  Calibration begins by determining the bandpass correction, using <command>mfcal</command> with
	  your bandpass calibrator. To prevent rapid gain variations from being entangled with your bandpass
	  solution, the <parameter>interval</parameter> parameter should be set to the cycle time (which is
	  usually 0.1 minutes). Since your bandpass calibrator should be very bright, such a short interval
	  should still have plenty of signal-to-noise. By default, <command>mfcal</command> uses
	  CA03 as the reference antenna, but if that antenna wasn't available during the observations,
	  ensure that you set <parameter>refant</parameter> to be an antenna that was available.
	</para>
	
	<para>
	  If you are reducing 3mm data, and CA02 was available, you should set it as the reference antenna.
	  You should do this because it has the only noise diode in the array at 3mm, and setting it as the
	  reference antenna may make it easier to do polarisation calibration.
	</para>
	
	<informaltable frame="none">
	  <tgroup cols="2" align="left" colsep="0" rowsep="0">
	    <colspec colname="cm"/>
	    <colspec colname="mm"/>
	    <thead>
	      <row>
		<entry>cm reduction</entry>
		<entry>mm reduction</entry>
	      </row>
	    </thead>
	    <tbody>
	      <row>
		<entry>
		  <screen>
		    Task:   mfcal
		    vis      = 1934-638.2100/
		    line     =  
		    stokes   =  
		    edge     =  
		    select   =  
		    flux     =  
		    refant   =  
		    minants  =  
		    interval = 0.1
		    options  =  
		    tol      =  
		  </screen>
		</entry>
		<entry>
		  <screen>
		    Task:   mfcal
		    vis      = 1921-293.17000/
		    line     =  
		    stokes   =  
		    edge     =  
		    select   =  
		    flux     =  
		    refant   =  
		    minants  =  
		    interval = 0.1
		    options  =  
		    tol      =  
		  </screen>
		</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>
	
	<para>
	  Bandpass calibration in the cm bands (16 &amp; 4) is usually done with the <acronym>ATCA</acronym>
	  primary flux calibrator 1934-638, as it is quite bright at these frequencies. Since the flux
	  density of 1934-638 is known as a function of frequency, the bandpass solution obtained in these
	  bands is very good and takes into account how 1934-638 varies across the band. But if you use another
	  calibrator for which <application>Miriad</application> doesn't have a flux density model, then
	  the bandpass solution will be dependent on how that calibrator's flux density varies with
	  frequency, which is a bad situation. You will need to correct for this, and how to do this
	  correction will be described later on.
	</para>
      </section>
	
      <section>
	<info>
	  <title>Gain and polarisation calibration</title>
	</info>
	<para>
	  After bandpass calibration, the next step is to do some time-variable gain and polarisation
	  calibration. If the bandpass calibrator is 1934-638, or if the bandpass calibrator has been
	  observed several times during the run over a large range of parallactic angle, then you can
	  use it for this step. Otherwise you should use the gain calibrator you observed.
	</para>
	
	<informaltable frame="none">
	  <tgroup cols="2" align="left" colsep="0" rowsep="0">
	    <colspec colname="cm"/>
	    <colspec colname="mm"/>
	    <thead>
	      <row>
		<entry>cm reduction</entry>
		<entry>mm reduction</entry>
	      </row>
	    </thead>
	    <tbody>
	      <row>
		<entry>
		  <screen>
		    Task:   gpcal
		    vis      = 1934-638.2100/
		    select   =  
		    line     =  
		    flux     =  
		    refant   =
		    minants  =  
		    interval = 0.1
		    nfbin    = 2  
		    tol      =  
		    xyphase  =  
		    options  = xyvary
		  </screen>
		</entry>
		<entry>
		  <screen>
		    Task:   gpcopy
		    vis      = 1921-293.17000
		    out      = 2243-123.17000
		    mode     =  
		    options  =  

		    Task:   gpcal
		    vis      = 2243-123.17000/
		    select   =  
		    line     =  
		    flux     =  
		    refant   =
		    minants  =  
		    interval = 0.1
		    nfbin    = 2  
		    tol      =  
		    xyphase  =  
		    options  = xyvary,qusolve
		  </screen>
		</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>
	
	<para>
	  You should use an <parameter>nfbin</parameter> of at least 2 for all bands. This will
	  allow <command>gpboot</command> to correct any linear slope errors present in the
	  bandpass table. This also makes it unnecessary to use <command>mfboot</command>
	  unless your flux calibrator is a planet. You should also increase the
	  <parameter>interval</parameter> parameter if the calibrator is not bright enough to
	  give enough signal-to-noise with 0.1 minutes of integration time.
	</para>
      </section>

      <section>
	<info>
	  <title>Flux density calibration</title>
	</info>

	<section>
	  <info>
	    <title>Calibration in the cm bands</title>
	  </info>

	  <para>
	    If you used 1934-638 in the <command>mfcal</command> and <command>gpcal</command>
	    steps, then you already have a flux calibrated dataset that can be used to
	    fix the flux density scale on the other datasets.
	  </para>

	  <para>
	    You should now copy the solutions from the 1934-638 dataset to the gain calibrator
	    dataset using <command>gpcopy</command>, and determine the time-variable gains with
	    <command>gpcal</command>.
	  </para>

	  <screen>
	    Task:   gpcopy
	    vis      = 1934-638.2100/
	    out      = 2243-123.2100/
	    mode     =  
	    options  =
	    
	    Task:   gpcal
	    vis      = 2243-123.2100/
	    select   =  
	    line     =  
	    flux     =  
	    refant   =
	    minants  =  
	    interval = 0.1
	    nfbin    = 2  
	    tol      =  
	    xyphase  =  
	    options  = xyvary,qusolve
	  </screen>

	  <para>
	    The <command>gpcal</command> step is likely to make the flux density scale on
	    your gain calibrator slightly different to the true scale. To fix this you should
	    use <command>gpboot</command>.
	  </para>

	  <screen>
	    Task:   gpboot
	    vis      = 2243-123.2100/
	    cal      = 1934-638.2100/
	    select   =  
	  </screen>

	  <para>
	    You can now be confident that your gain calibrator is properly flux calibrated,
	    and can now proceed to use it to analyse your science target.
	  </para>
	</section>
	
	<section id="calibration-in-the-mm-bands">
	  <info>
	    <title>Calibration in the mm bands</title>
	  </info>
	  <para>
	    At this point in the mm reduction, you need to do the flux calibration. How this happens
	    depends on whether you're using a planet as the flux calibrator, or 1934-638. After copying
	    the calibration tables from the calibrator used in the <command>gpcal</command> step
	    to the flux calibrator, you use <command>gpcal</command> followed by
	    <command>gpboot</command> if you're using 1934-638, or <command>mfboot</command> for
	    planets.
	  </para>
	  
	  <informaltable frame="none">
	    <tgroup cols="2" align="left" colsep="0" rowsep="0">
	      <colspec colname="pointsource"/>
	      <colspec colname="planet"/>
	      <thead>
		<row>
		  <entry>1934-638 flux calibrator</entry>
		  <entry>planetary calibrator</entry>
		</row>
	      </thead>
	      <tbody>
		<row>
		  <entry>
		    <screen>
		      Task:   gpcopy
		      vis      = 2243-123.17000/
		      out      = 1934-638.17000/
		      mode     =  
		      options  =
	    
		      Task:   gpcal
		      vis      = 1934-638.17000/
		      select   =  
		      line     =  
		      flux     =  
		      refant   =
		      minants  =  
		      interval = 0.1
		      nfbin    = 2  
		      tol      =  
		      xyphase  =  
		      options  = xyvary,qusolve,nopol
		      
		      Task:   gpboot
		      vis      = 2243-123.17000/
		      cal      = 1934-638.17000/
		      select   =  
		    </screen>
		  </entry>
		  <entry>
		    <screen>
		      Task:   gpcopy
		      vis      = 2243-123.33000/
		      out      = uranus.33000/
		      mode     =  
		      options  =

		      Task:   mfboot
		      vis      = 2243-123.33000,uranus.33000/
		      line     =  
		      select   = source(uranus)
		      flux     =  
		      mode     =  
		      clip     =  
		      device   = /xs
		      options  =  
		    </screen>
		  </entry>
		</row>
	      </tbody>
	    </tgroup>
	  </informaltable>

	  <para>
	    Note the use of the <option>nopol</option> option for the <parameter>options</parameter>
	    parameter in <command>gpcal</command>, when 1934-638 is being used as the flux calibrator.
	    This option tells <command>gpcal</command> that it should accept the leakage solution
	    obtained from the gain calibrator, which should be good since the gain calibrator is likely
	    to have much greater hour-angle coverage than the flux calibrator.
	  </para>

	  <para>
	    In May 2016, <application>Miriad</application>'s high-frequency flux density scale for 1934-638 was
	    changed to align the <acronym>ATCA</acronym>'s scale to that of the <acronym>VLA</acronym> and the
	    absolute scale used by <emphasis>Planck</emphasis>. See <xref linkend="calibration-flux-density" />
	    for details about this new scale. By default, after May 2016, <application>Miriad</application>
	    uses this new scale when setting the flux density of 1934-638 for frequencies above 11 GHz. The flux
	    densities measured from reductions using pre-May 2016 and post-May 2016
	    <application>Miriad</application> will therefore differ for observations above 11 GHz. If you would
	    like to keep using the pre-May 2016 flux density scale for 1934-638, you should use the
	    <option>oldflux</option> option that is available in the <command>mfcal</command>,
	    and <command>gpcal</command> commands.
	  </para>
	  
	  <para>
	    At this point the gain calibrator will be reasonably well flux calibrated. If you are
	    not especially concerned about flux calibration accuracy, you can proceed to analyse your
	    science target.
	  </para>

	 <para>
	   If you want to flux calibrate your data as well as possible, then you can use data from
	   the other simultaneously observed band to improve your solution. Basically, the bandpass
	   solution you made earlier assumed that the bandpass calibrator had a constant amplitude
	   with frequency (i.e. a flat-spectrum source). Because of this, the bandpass solution will
	   likely be in error. Our gain solutions with two bins will have corrected this somewhat,
	   but we can also try to emulate the situation in the cm band, and provide
	   <command>mfcal</command> with a model of the flux density of the bandpass calibrator.
	 </para>

	 <para>
	   To do this, we copy the gain solutions from the gain calibrator back to the bandpass
	   calibrator, recalibrate, and bootstrap the flux density scale.
	 </para>
	 <screen>
	   Task:   gpcopy
	   vis      = 2243-123.17000/
	   out      = 1921-293.17000/
	   mode     =  
	   options  =
	   
	   Task:   gpcal
	   vis      = 1921-293.17000/
	   select   =  
	   line     =  
	   flux     =  
	   refant   =
	   minants  =  
	   interval = 0.1
	   nfbin    = 2  
	   tol      =  
	   xyphase  =  
	   options  = xyvary,qusolve,nopol
	   
	   Task:   gpboot
	   vis      = 1921-293.17000/
	   cal      = 2243-123.17000/
	   select   =  
	 </screen>
	 <para>
	   Note that these steps don't change regardless of the type of flux calibrator you are
	   using.
	 </para>

	 <para>
	   You should do the same calibration process with the other simultaneously observed band.
	   At the end of the process you should have two bandpass calibrator datasets, each being
	   flux calibrated via the gain calibrator. You can now measure the flux density of the
	   bandpass calibrator over the entire range of observed frequencies, using the
	   <command>uvfmeas</command> task. The principle here is that even if the slope over
	   a single band is wrong due to the incorrect bandpass calibration assumption, fitting
	   a flux density model using two independently-calibrated bands should lower the
	   uncertainties and provide a very good model of the actual flux density of the source.
	 </para>
	 <screen>
	   Task:   uvfmeas
	   vis      = 1921-293.17000/,1921-293.19000/
	   select   =  
	   line     =  
	   stokes   = i
	   hann     =  
	   offset   =  
	   order    = 1
	   options  = plotvec,log,mfflux
	   yrange   =  
	   device   = /xs
	   nxy      =  
	   log      =  
	   fitp     =  
	   feval    =  
	 </screen>

	 <para>
	   The <command>uvfmeas</command> task does a linear least-squares fit to the
	   log of the vector-averagde Stokes I flux density as a function of the log of the frequency.
	   The plot it makes will show the averaged data in both bands, and the line of best
	   fit (<xref linkend="uvfmeas-1921-example"></xref>). It will also output a string like:
	 </para>
	 <screen>
	   MFCAL flux= 9.4126, 17.0,-0.3801
	 </screen>

	 <figure id="uvfmeas-1921-example">
	   <title>
	     A plot made using <command>uvfmeas</command>, showing the line of best fit
	     for the flux density model.
	   </title>
	   <mediaobject>
	     <imageobject>
	       <imagedata fileref="figures/1921-293.uvfmeas.png" format="PNG">
	       </imagedata>
	     </imageobject>
	   </mediaobject>
	 </figure>

	 <para>
	   The string is usable as the <parameter>flux</parameter> in <command>mfcal</command>,
	   which will fit the bandpass solution while assuming the flux density model we just
	   determined. The image in <xref linkend="uvfmeas-1921-example"></xref> is actually
	   the result of this two stage process, and you can see the excellent alignment
	   between the two bands, which are independently processed.
	 </para>

	 <para>
	   Once you have measured the flux density model for the bandpass calibrator, you
	   must redo the calibration, but the bandpass calibrator becomes the flux density
	   calibrator. The process is slightly different as well, and is summarised below.
	 </para>

	 <screen>
	   Task:   mfcal
	   vis      = 1921-293.17000/
	   line     =  
	   stokes   =  
	   edge     =  
	   select   =  
	   flux     = 9.4126,17.0,-0.3801
	   refant   =  
	   minants  =  
	   interval = 0.1
	   options  =  
	   tol      =  
	   
	   Task:   gpcopy
	   vis      = 1921-293.17000/
	   out      = 2243-123.17000/
	   mode     =  
	   options  =
	   
	   Task:   gpcal
	   vis      = 2243-123.17000/
	   select   =  
	   line     =  
	   flux     =  
	   refant   =
	   minants  =  
	   interval = 0.1
	   nfbin    = 2  
	   tol      =  
	   xyphase  =  
	   options  = xyvary,qusolve

	   Task:   gpcopy
	   vis      = 2243-123.17000/
	   out      = 1921-293.17000/
	   mode     =  
	   options  =

	   Task:   gpcal
	   vis      = 1921-293.17000/
	   select   =  
	   line     =  
	   flux     =  
	   refant   =
	   minants  =  
	   interval = 0.1
	   nfbin    = 2  
	   tol      =  
	   xyphase  =  
	   options  = xyvary,qusolve,nopol

	   Task:   gpboot
	   vis      = 2243-123.17000/
	   cal      = 1921-293.17000/
	   select   =  
	   
	   Task:   mfboot
	   vis      = 2243-123.17000,1921-293.17000/
	   line     =  
	   select   = source(1921-293)
	   flux     = 9.4126,17.0,-0.3801
	   mode     =  
	   clip     =  
	   device   = /xs
	   options  =  
	 </screen>

	 <para>
	   At this point both the bandpass and gain calibrator datasets will be very accurately
	   flux calibrated. Simulations suggest that this two-stage process can improve the flux
	   calibration accuracy to the 1% level for the bandpass calibrator, and to around the
	   3% level for any other calibrators referenced to it. Observations have confirmed this
	   in the 15mm band, while for the 7mm band the flux calibration accuracy for an arbitrary gain
	   calibrator is around 10%.
	 </para>
	</section>
      </section>

      <section>
	<info>
	  <title>General advice</title>
	</info>

	<para>
	  The calibration technique outlined above is robust and generally applicable, but may not
	  work adequately for your data without alteration, and will almost certainly not work in
	  an automated fashion. You should always be prepared to iterate between flagging and
	  calibration, and you should use the visualisation tasks <command>uvplt</command>,
	  <command>uvspec</command> and <command>closure</command> to check that the calibrator
	  visibilities look as they should. You can also look at the calibration solutions directly
	  using the <command>gpplt</command> task. Using <command>uvfmeas</command> to view the
	  calibrators in both simultaneously-observed bands may also give you confidence that your
	  calibration is good, or otherwise.
	</para>
      </section>
    </section>

    <section id="Imaging">
      <info>
        <title>Imaging</title>
      </info>
      <para>
	Imaging of <acronym>CABB</acronym> data can be performed in exactly the same way as pre-<acronym>CABB</acronym> data,
	however you may get better results with a slightly different method.
      </para>

      <para>
	For high-frequency observations, where a bandwidth of 2 GHz does not represent
	a very large fraction of the sky frequency, then the imaging strategy used for
	pre-<acronym>CABB</acronym> data will most likely be adequate. For lower frequencies the
	multi-frequency strategies are more likely to produce good results. In particular,
	the use of the <command>mfclean</command> task should be considered. Read the excellent
	description of why <command>mfclean</command> is necessary
	<ulink url="http://www.atnf.csiro.au/computing/software/miriad/userguide/node110.html">
	  in the <application>Miriad</application> cookbook</ulink>
	to see if you will need to proceed with this strategy.
      </para>

      <para>
	If you don't need <command>mfclean</command> then you should proceed with the usual
	<command>invert</command>, <command>clean</command> and <command>restor</command> 
	method of creating an image, and combine
	this with <command>selfcal</command> or <command>gpscal</command> if 
	appropriate. In this case, nothing should be different
	from pre-<acronym>CABB</acronym> reduction.
      </para>

      <para>
	If you do need <command>mfclean</command> then the inputs to <command>invert</command> will need to be
	slightly different as well. Firstly, both the <option>mfs</option> and <option>sdb</option>
	options will need to be passed to <command>invert</command>. <command>mfclean</command> also requires
	that the beam be three times the size of the region being cleaned, which can be quickly specified
	in the latest version of <application>Miriad</application> in the <parameter>imsize</parameter>.
      </para>

      <screen>
	Task:   invert
	vis      = obs.uv
	map      = obs.map
	beam     = obs.beam
	imsize   = 3,3,beam
	cell     = 
	offset   =
	fwhm     = 
	sup      = 
	robust   = 0.5
	line     =
	ref      =
	select   = 
	stokes   = i
	options  = mfs,sdb
	mode     =
	slop     =
      </screen>
      <para>
	The first two options to the <parameter>imsize</parameter> parameter are usually the
	number of pixels in the x and y direction respectively that the image will have. But when
	you specify the <option>beam</option> option as the third argument to
	<parameter>imsize</parameter>, the first two options are interpreted as multiples of the
	FWHM of the primary beam at the central frequency of the image. In the example above, both the
	dirty image and the synthesised beam image would cover 3 times the primary beam FWHM in each 
	direction. In earlier versions
	of <application>Miriad</application>, both the <parameter>imsize</parameter> and
	<parameter>cell</parameter> parameters would have needed to be determined manually and
	explicitly set to do the same thing.
      </para>

      <para>
	With the synthesised beam covering 3 times the primary beam FWHM,
	<command>mfclean</command> can be used to clean the entire primary beam.
      </para>
      <screen>
	Task:   mfclean
	map      = obs.map
	beam     = obs.beam
	model    =
	out      = obs.clean
	gain     =
	cutoff   =
	niters   =
	region   = percentage(33)
	minpatch =
	speed    =
	mode     =
	log      =
      </screen>
      <para>
	Here we are selecting the central third of the image (the primary beam
	area) with the <parameter>region</parameter> keyword. This also satisfies the
	<command>mfclean</command> requirement that a guard band be present around the
	region being cleaned. The other parameters are very similar to those
	of <command>clean</command> and should be set as usual to obtain good results.
      </para>

      <para>
	After <command>mfclean</command> has run, <command>restor</command> should be used in the normal
	way to produce the cleaned image. <command>selfcal</command> can also be used in the
	usual fashion in this process.
      </para>
    </section>
  </section>

  <section id="Publishing-Results">
    <info>
      <title>Publishing Results</title>
    </info>
    <section id="ATNF-Acknowledgements">
      <info>
        <title><acronym>ATNF</acronym> Acknowledgements</title>
      </info>
      <para>
	Observers are requested to acknowledge the <acronym>ATNF</acronym> in any publications
	resulting from the use of the <acronym>ATNF</acronym> as follows:
      </para>
      <blockquote>
	<para>
	  The Australia Telescope is funded by the Commonwealth of Australia
	  for operation as a National Facility managed by <acronym>CSIRO</acronym>.
	</para>
      </blockquote>
      <para>
	Where possible, authors are requested to include one of the terms
	&#x201C;<acronym>ATNF</acronym>&#x201D; or &#x201C;Australia Telescope&#x201D; 
	in the Abstract of their papers.
	This is to facilitate electronic searches for publications that
	include <acronym>ATNF</acronym> data.
      </para>
      <!-- Please inform TBD (@email{TBD}) -->
      <!-- of any publications that include <acronym>ATNF</acronym> data. -->
      <!-- @node Giving a Talk at <acronym>ATNF</acronym> -->
      <!-- @subsection Giving a Talk at <acronym>ATNF</acronym> -->
    </section>
  </section>
</chapter>

